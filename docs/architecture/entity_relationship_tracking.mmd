graph TD
    A[Mutation Starts] --> B[Initialize Tracker]
    B --> C[Track Primary Entity]

    C --> D{Depth < MaxDepth?}
    D -->|Yes| E[Find Related Entities]
    D -->|No| F[Stop Cascade]

    E --> G{Entity Already Tracked?}
    G -->|Yes| H[Skip - Prevent Cycles]
    G -->|No| I[Track Related Entity]

    I --> J{Entity Excluded?}
    J -->|Yes| K[Skip Excluded Entity]
    J -->|No| L[Add to Cascade]

    L --> M[Increment Depth]
    M --> D

    F --> N[Build Cascade Response]
    K --> N
    H --> N

    N --> O[Return Updated Entities]

    style A fill:#e1f5fe
    style C fill:#f3e5f5
    style E fill:#e8f5e8
    style L fill:#fff3e0
    style O fill:#e8f5e8

    subgraph "Example: Update Company"
        P[Company<br/>id: 123] --> Q[Address<br/>id: 456]
        Q --> R[City<br/>id: 789]
        P --> S[Owner<br/>User id: 101]
        S --> T[Profile<br/>id: 202]
    end

    subgraph "Cascade Result"
        U[updated: Company, Address, City, User, Profile]
        V[deleted: none]
        W[invalidations: listCompanies, getCompany]
    end
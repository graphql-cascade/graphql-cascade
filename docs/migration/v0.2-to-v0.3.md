# Migration Guide: v0.2 to v0.3

## Overview

GraphQL Cascade v0.3.0 is a production-ready release that introduces enhanced error handling while maintaining full backward compatibility. This guide covers the changes and migration steps.

## What's New in v0.3.0

### Enhanced Error Handling (Spec v1.1 Compliance)

Complete implementation of the Cascade specification v1.1 error codes:

- **Network Errors**: `TIMEOUT`, `RATE_LIMITED`, `SERVICE_UNAVAILABLE`
- **Client Errors**: `VALIDATION_ERROR`, `NOT_FOUND`, `UNAUTHORIZED`, `FORBIDDEN`
- **Server Errors**: `CONFLICT`, `TRANSACTION_FAILED`, `INTERNAL_ERROR`

### Production Readiness Features

- Comprehensive error handling utilities across all client packages
- Enhanced TypeScript types with improved error information
- Version alignment cleanup for consistent versioning
- Production-ready stability improvements

## Migration Steps

### No Breaking Changes

**Good news!** This release is fully backward compatible with v0.2.0. No code changes are required for existing applications.

### Optional: Enhanced Error Handling

If you want to take advantage of the new error codes, you can update your error handling:

#### Before (v0.2.0)

```typescript
import { isCascadeError } from '@graphql-cascade/client';

try {
  await mutate(UPDATE_USER, { id: '123', name: 'John' });
} catch (error) {
  if (isCascadeError(error)) {
    // Handle cascade errors
    console.error('Cascade error:', error);
  }
}
```

#### After (v0.3.0) - Enhanced Error Handling

```typescript
import { isCascadeError, createCascadeError } from '@graphql-cascade/client';

try {
  await mutate(UPDATE_USER, { id: '123', name: 'John' });
} catch (error) {
  if (isCascadeError(error)) {
    switch (error.code) {
      case 'TIMEOUT':
        // Handle timeout - retry logic
        console.error('Request timed out, retrying...');
        break;
      case 'RATE_LIMITED':
        // Handle rate limiting - backoff strategy
        console.error('Rate limited, backing off...');
        break;
      case 'VALIDATION_ERROR':
        // Handle validation errors - show user feedback
        console.error('Validation failed:', error.message);
        break;
      case 'NOT_FOUND':
        // Handle not found - redirect or show 404
        console.error('Resource not found');
        break;
      case 'UNAUTHORIZED':
      case 'FORBIDDEN':
        // Handle auth errors - redirect to login
        console.error('Authentication required');
        break;
      case 'CONFLICT':
        // Handle conflicts - show merge UI
        console.error('Data conflict detected');
        break;
      default:
        // Handle other errors
        console.error('Cascade error:', error);
    }
  }
}
```

### Type Changes

#### CascadeErrorInfo (Renamed from CascadeError)

The main error type has been renamed for clarity:

```typescript
// v0.2.0
import { CascadeError } from '@graphql-cascade/client';

// v0.3.0 (CascadeError still works for backward compatibility)
import { CascadeErrorInfo } from '@graphql-cascade/client';
```

### New Error Creation Utilities

```typescript
import { createCascadeError, createTimeoutError, createRateLimitError } from '@graphql-cascade/server';

// Create specific error types
const timeoutError = createTimeoutError('Request timed out');
const rateLimitError = createRateLimitError('Too many requests');

// Or create custom errors
const customError = createCascadeError('VALIDATION_ERROR', 'Invalid input data');
```

## Package Updates

All packages have been updated to v0.3.0:

```json
{
  "@graphql-cascade/server": "^0.3.0",
  "@graphql-cascade/client": "^0.3.0",
  "@graphql-cascade/client-apollo": "^0.3.0",
  "@graphql-cascade/client-react-query": "^0.3.0",
  "@graphql-cascade/client-relay": "^0.3.0",
  "@graphql-cascade/client-urql": "^0.3.0",
  "@graphql-cascade/cli": "^0.3.0"
}
```

## Testing Your Migration

### Run Tests

```bash
# Install updated packages
npm update @graphql-cascade/*

# Run your test suite
npm test

# Check for any deprecation warnings
npm run build
```

### Verify Error Handling

Test the new error codes in your application:

```typescript
// Test timeout handling
// Test rate limiting scenarios
// Test validation errors
// Test authentication errors
```

## Troubleshooting

### Common Issues

**"Module not found" errors**
- Ensure all packages are updated to v0.3.0
- Clear node_modules and reinstall: `rm -rf node_modules && npm install`

**TypeScript compilation errors**
- The `CascadeError` type still exists for backward compatibility
- Update imports to use `CascadeErrorInfo` for new code

**Runtime errors**
- Check that your GraphQL server supports the new error codes
- Verify client and server versions are compatible

### Getting Help

- Check the [troubleshooting guide](../guide/troubleshooting.md)
- Review the [error handling documentation](../guide/concepts.md#error-handling)
- Open an issue on GitHub if you encounter problems

## Performance Impact

- **Memory**: No significant change from v0.2.0
- **Bundle size**: Minimal increase due to additional error utilities
- **Runtime performance**: No regression, improved error handling efficiency

## Rollback Plan

If you need to rollback:

```bash
# Downgrade all packages
npm install @graphql-cascade/server@0.2.0 @graphql-cascade/client@0.2.0 ...
```

The v0.2.0 packages remain available and fully supported.

## Next Steps

- Monitor error rates and user experience with enhanced error handling
- Consider implementing retry logic for `TIMEOUT` and `RATE_LIMITED` errors
- Explore optimistic updates for better UX (available in client packages)

---

*For detailed API documentation, see [API Reference](../api/)*
*For release notes, see [v0.3.0 Release Notes](https://github.com/graphql-cascade/graphql-cascade/blob/main/releases/v0.3.0.md)*